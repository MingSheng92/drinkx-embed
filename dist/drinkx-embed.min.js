(()=>{(function(u,r){"use strict";function m(c,e){let t;return function(...n){let s=()=>{clearTimeout(t),c(...n)};clearTimeout(t),t=setTimeout(s,e)}}function p(c,e="",t=""){let i=r.createElement(c);return e&&(i.className=e),t&&(i.innerHTML=t),i}function o(c){let e=r.createElement("div");return e.textContent=c,e.innerHTML}class g{constructor(e,t={}){this.containerId=e,this.container=r.getElementById(e),this.options={venueId:t.venueId,apiUrl:t.apiUrl||"https://business.untappd.com/api",theme:t.theme||"light",showSearch:t.showSearch!==!1,showRatings:t.showRatings!==!1,showPrices:t.showPrices!==!1,...t},this.menuData=null,this.originalMenuData=null,this.searchQuery="",this.isSearchActive=!1,this.currentDisplayMenu=null,this.init()}async init(){if(!this.container){console.error(`Container with ID "${this.containerId}" not found`);return}this.render(),await this.loadMenuData()}render(){this.container.innerHTML=`
                <div class="menu-embed-container">
                    <div class="menu-embed-loading">Loading menu...</div>
                </div>
            `}async loadMenuData(){try{let t=await(await fetch(`${this.options.apiUrl}/menu/${this.options.venueId}`)).json(),i=t.filter(n=>!n.isSubSection).map(n=>({...n,isExpanded:!1,subSections:t.filter(s=>s.isSubSection&&s.parentSectionId===n.id).map(({id:s,sectionName:a,sectionOrder:d})=>({id:s,sectionName:a,sectionOrder:d,isExpanded:!1,sectionMenu:[],isLoading:!1}))}));this.menuData={menu:i},this.originalMenuData=JSON.parse(JSON.stringify(this.menuData)),this.currentDisplayMenu=this.menuData,this.renderMenu()}catch(e){console.error("Failed to load menu data:",e),this.container.innerHTML=`
                    <div class="menu-embed-container">
                        <div class="menu-embed-empty">Failed to load menu. Please try again later.</div>
                    </div>
                `}}renderMenu(){let e=this.currentDisplayMenu,t=e.menu&&e.menu.length||0,i=`
                <div class="menu-embed-container">
                    <div class="menu-embed-header">
                        <p class="menu-embed-section-count">${o(t)} Sections On The Menu</p>
                    </div>
            `;this.options.showSearch&&(i+=`
                    <input type="text" class="menu-embed-search" placeholder="Search menu..." value="${o(this.searchQuery)}">
                `),e.menu&&e.menu.length>0?(i+='<div class="menu-embed-sections">',e.menu.forEach((n,s)=>{i+=this.renderSection(n,s)}),i+="</div>"):i+=`<div class="menu-embed-empty">This venue hasn't added any drinks to their menu yet.</div>`,i+="</div>",this.container.innerHTML=i,this.bindEvents()}renderSection(e,t){let i=e.isExpanded,n=i?"expanded":"",s=`
                <div class="menu-embed-section" data-section-index="${t}">
                    <div class="menu-embed-section-header" data-section-toggle="${t}">
                        <h6 class="menu-embed-section-title">${o(e.sectionName)}</h6>
                        <span class="menu-embed-chevron ${n}">\u25BC</span>
                    </div>
                    <div class="menu-embed-section-content ${i?"":"collapsed"}" data-section-content="${t}">
            `;return e.isLoading?s+='<div class="menu-embed-loading">Loading...</div>':(e.subSections&&e.subSections.length>0&&e.subSections.forEach(a=>{s+=this.renderSubSection(a)}),e.sectionMenu&&e.sectionMenu.length>0&&(e.sectionMenu.forEach(a=>{s+=this.renderMenuItem(a)}),e.pagination&&e.pagination.total_pages>1&&(s+=this.renderPagination(e.pagination,t))),(!e.subSections||e.subSections.length===0)&&(!e.sectionMenu||e.sectionMenu.length===0)&&(s+='<div class="menu-embed-empty">No items in this section.</div>')),s+="</div></div>",s}renderSubSection(e){let t=e.isExpanded,i=t?"expanded":"",n=`
                <div class="menu-embed-section" data-subsection-id="${e.id}">
                    <div class="menu-embed-section-header" data-subsection-toggle="${e.id}">
                        <h6 class="menu-embed-section-title">${o(e.sectionName)}</h6>
                        <span class="menu-embed-chevron ${i}">\u25BC</span>
                    </div>
                    <div class="menu-embed-section-content ${t?"":"collapsed"}">
            `;return e.isLoading?n+='<div class="menu-embed-loading">Loading...</div>':e.sectionMenu&&e.sectionMenu.length>0?e.sectionMenu.forEach(s=>{n+=this.renderMenuItem(s)}):n+='<div class="menu-embed-empty">No items in this sub-section.</div>',n+="</div></div>",n}renderMenuItem(e){let t=e.itemAvailability===!1?"grayscale(100%)":"none",i=e.photo&&e.photo.trim()!==""?`<img src="${o(e.photo)}" alt="${o(e.name)}" style="filter: ${t};">`:'<span style="font-size: 28px; color: #d4941e;">\u{1F37A}</span>',n=this.options.showRatings?e.averageRating==0?'<span class="menu-embed-star">\u2606</span>':`<div class="menu-embed-rating"><b>${o(e.averageRating)}</b><span class="menu-embed-star">\u2605</span></div>`:"",s=this.options.showPrices?`<p class="menu-embed-item-price">${e.itemPrice<=0?"-":`$ ${o(e.itemPrice)} / ${o(e.servingTypeText)||"serving"}`}</p>`:"",a=e.itemAvailability===!1?'<p class="menu-embed-unavailable">Temporarily Unavailable</p>':"";return`
                <div class="menu-embed-item" data-item-id="${e.itemID}">
                    <div class="menu-embed-item-image">
                        ${i}
                    </div>
                    <div class="menu-embed-item-content">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                            <h5 class="menu-embed-item-title">${o(e.name)}${e.variant?` [${o(e.variant)} Vintage]`:""}</h5>
                            ${n}
                        </div>
                        <p class="menu-embed-item-meta">${o(e.bottler)||"Unknown Producer"} | ${o(e.drinkType)||"N/A type"} | ${e.abv?o(e.abv)+"%":"N/A ABV"}</p>
                        <p class="menu-embed-item-description">${o(e.description)||""}</p>
                        ${s}
                        ${a}
                    </div>
                </div>
            `}renderPagination(e,t){return`
                <div class="menu-embed-pagination" data-section-pagination="${t}">
                    <button ${e.page<=1?"disabled":""} data-page="${e.page-1}">Previous</button>
                    <span>Page ${o(e.page)} of ${o(e.total_pages)}</span>
                    <button ${e.page>=e.total_pages?"disabled":""} data-page="${e.page+1}">Next</button>
                </div>
            `}bindEvents(){if(this.options.showSearch){let e=this.container.querySelector(".menu-embed-search");if(e){let t=m(i=>this.handleSearch(i.target.value),500);e.addEventListener("input",t)}}this.container.addEventListener("click",e=>{if(e.target.closest("[data-section-toggle]")){let t=e.target.closest("[data-section-toggle]").dataset.sectionToggle;this.toggleSection(parseInt(t))}if(e.target.closest("[data-subsection-toggle]")){let t=e.target.closest("[data-subsection-toggle]").dataset.subsectionToggle;this.toggleSubSection(t)}if(e.target.closest("[data-section-pagination] button")){let t=e.target.closest("button"),i=e.target.closest("[data-section-pagination]").dataset.sectionPagination,n=parseInt(t.dataset.page);t.disabled||this.loadSectionMenu(parseInt(i),n)}if(e.target.closest("[data-item-id]")){let t=e.target.closest("[data-item-id]").dataset.itemId;this.options.onItemClick&&this.options.onItemClick(t)}})}async toggleSection(e){let t=this.currentDisplayMenu.menu[e];t.isExpanded=!t.isExpanded,t.isExpanded&&this.searchQuery.trim()===""&&(!t.sectionMenu||t.sectionMenu.length===0)&&await this.loadSectionMenu(e),this.updateSectionDisplay(e)}async toggleSubSection(e){let t=null;this.currentDisplayMenu.menu.forEach(i=>{i.subSections&&i.subSections.forEach(n=>{n.id==e&&(t=n)})}),t&&(t.isExpanded=!t.isExpanded,t.isExpanded&&this.searchQuery.trim()===""&&(!t.sectionMenu||t.sectionMenu.length===0)&&await this.loadSectionMenu(null,1,t),this.renderMenu())}updateSectionDisplay(e){let t=this.container.querySelector(`[data-section-content="${e}"]`),i=this.container.querySelector(`[data-section-toggle="${e}"] .menu-embed-chevron`),n=this.currentDisplayMenu.menu[e];t&&i&&(n.isExpanded?(t.classList.remove("collapsed"),i.classList.add("expanded")):(t.classList.add("collapsed"),i.classList.remove("expanded")))}async loadSectionMenu(e,t=1,i=null){let n=i||this.currentDisplayMenu.menu[e],s=n.id;if(!n.isLoading)try{n.isLoading=!0,this.renderMenu();let a=await fetch(`${this.options.apiUrl}/getData/getVenueMenu/${s}?page=${t}&limit=30`);if(!a.ok)throw new Error(`HTTP ${a.status}`);let d=await a.json(),l=d.data||[],h=d.pagination||{page:t,limit:30,total_pages:1};n.sectionMenu=l,n.pagination=h,n.itemCount=h.total_items||l.length}catch(a){console.error(`Error loading menu section ${s}:`,a),n.hasError=!0,n.sectionMenu=[]}finally{n.isLoading=!1,this.renderMenu()}}async handleSearch(e){if(this.searchQuery=e,e.trim()===""){this.isSearchActive=!1,this.currentDisplayMenu=this.originalMenuData,this.renderMenu();return}try{let t=await fetch(`${this.options.apiUrl}/getData/getVenueMenuBySearch/${this.options.venueId}?searchTerm=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);let i=await t.json(),n=JSON.parse(JSON.stringify(this.originalMenuData));n.menu.forEach(s=>{s.sectionMenu=[],s.isExpanded=!1,s.subSections&&s.subSections.forEach(a=>{a.sectionMenu=[],a.isExpanded=!1})}),i.menu&&this.populateSearchResults(n,i),this.currentDisplayMenu=n,this.isSearchActive=!0,this.renderMenu()}catch(t){console.error("Search failed:",t)}}populateSearchResults(e,t){t.menu.forEach(i=>{let n=e.menu.find(s=>s.id===i.id||s.sectionName===i.sectionName);if(n){n.sectionMenu=i.sectionMenu||[];let s=n.sectionMenu.length>0;i.subSections&&n.subSections&&i.subSections.forEach(a=>{let d=n.subSections.find(l=>l.id===a.id||l.sectionName===a.sectionName);d&&(d.sectionMenu=a.sectionMenu||[],d.isExpanded=d.sectionMenu.length>0,d.isExpanded&&(s=!0))}),n.isExpanded=s}})}refresh(){this.loadMenuData()}updateOptions(e){this.options={...this.options,...e},this.renderMenu()}}u.MenuEmbed={create:function(c,e){return new g(c,e)}}})(window,document);document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-menu-embed]").forEach(r=>{let m=r.dataset.venueId,p=r.dataset.apiUrl,o=r.dataset.theme;m&&window.MenuEmbed.create(r.id,{venueId:m,apiUrl:p,theme:o})})});})();
